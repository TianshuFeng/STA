<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Semi-supervised topological analysis • STA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Semi-supervised topological analysis">
<meta property="og:description" content="STA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">STA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.22</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/STA.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Shiny_app_instruction.html">Shiny app instruction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TianshuFeng/STA/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Semi-supervised topological analysis</h1>
            
            <h4 class="date">2020-10-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/TianshuFeng/STA/blob/master/vignettes/STA.Rmd"><code>vignettes/STA.Rmd</code></a></small>
      <div class="hidden name"><code>STA.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This package aims to provide a comfortable and flexible way to explore the visualization of data based on Mapper, a topological data analysis method. It provides users with extensive tools to customize the visualization, optimally select filter functions and evaluate the results from Mapper .</p>
<p>To install the latest version of this R package directly from github:</p>
<pre><code>install.packages("devtools")
devtools::install_github("TianshuFeng/STA")</code></pre>
</div>
<div id="example-1-simple-graph-generation-with-semi-supervised-topological-analysis-sta" class="section level1">
<h1 class="hasAnchor">
<a href="#example-1-simple-graph-generation-with-semi-supervised-topological-analysis-sta" class="anchor"></a>Example 1: Simple graph generation with semi-supervised topological analysis (STA)</h1>
<div id="start-with-the-simulation-data" class="section level2">
<h2 class="hasAnchor">
<a href="#start-with-the-simulation-data" class="anchor"></a>Start with the simulation data</h2>
<p>This package provides a function <code>chicken_generator</code> to generate simulation data which is similar to a chicken foot. We will use it to demonstrate the tools of this package.</p>
<p>We start by applying Mapper directly to the simulated data with function <code>mapper.kmeans</code> and generate a graph with the basic visualization function <code>simple_visNet</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">STA</span>)
<span class="no">simu_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="kw">seed</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">simu_data_mapper</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper.kmeans.html">mapper.kmeans</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">simu_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                               <span class="kw">filter_values</span> <span class="kw">=</span> <span class="no">simu_data</span>$<span class="no">Y</span>,
                               <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>,
                               <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/simple_visNet.html">simple_visNet</a></span>(<span class="no">simu_data_mapper</span>, <span class="kw">filter</span> <span class="kw">=</span> <span class="no">simu_data</span>$<span class="no">Y</span>, <span class="kw">color_filter</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>In <code>chicken_generator</code>, the argument <code>seed</code> determines the seed to be used in data generation. The first column represent the groups of samples, and the last three columns are the coordinates of samples.</p>
<p>We apply Mapper to the simulated data with function <code>mapper.kmeans</code> modified from function <code>mapper</code> in package <code>TDAmapper</code>. In <code>mapper.kmeans</code>, <code>dat</code> accepts the input data, and <code>filter_values</code> accepts the filter vector. Here we use the Y-axis as the filter. <code>num_intervals</code> and <code>percent_overlap</code> are the number of intervals and the percentage of intervals overlapped, respectively, which decides how <code>simu_data$Y</code> is converted to the set of overlapping intervals.</p>
<p><code>simple_visNet</code> function visualize the graph from <code>mapper.kmeans</code>. It is capable of flexibly assigning colors to nodes in the graph. In this example, we set <code>color_filter = TRUE</code> and <code>filter = simu_data$Y</code>, and the colors of nodes are determined by the average values of the filters of samples in the nodes.</p>
</div>
<div id="play-with-colors" class="section level2">
<h2 class="hasAnchor">
<a href="#play-with-colors" class="anchor"></a>Play with colors</h2>
<p>We can also assign colors with the dominated group under each node with</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/STA/man/simple_visNet.html">simple_visNet</a></span>(<span class="no">simu_data_mapper</span>, <span class="kw">color_filter</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">groups_ind</span> <span class="kw">=</span> <span class="no">simu_data</span>$<span class="no">Group</span>)</pre></body></html></div>
<p>The colors will be determined by built-in function <code><a href="https://rdrr.io/pkg/STA/man/color_map_Spectral.html">color_map_Spectral()</a></code> based on the dominated groups. Users can also define their color function and pass it to argument <code>color_fun</code>. The color function should be able to accept numeric vectors and output hex color codes.</p>
<p>Alternatively, we can specify the colors of groups. This package provides several tools to help the users define colors for the groups. <code>auto_set_colorcode</code> can automatically generate color codes based on given palette. <code>read_color_code</code> can read color codes from local files and turn them into the appropriate format, and <code>check_color_code</code> checks the validity of provided color code data frame.</p>
<p>We demostrate these tools with the following codes:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">simu_color</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/auto_set_colorcode.html">auto_set_colorcode</a></span>(<span class="no">simu_data</span>$<span class="no">Group</span>, <span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Set1"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/check_color_code.html">check_color_code</a></span>(<span class="no">simu_color</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/simple_visNet.html">simple_visNet</a></span>(<span class="no">simu_data_mapper</span>, <span class="kw">color_filter</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
              <span class="kw">groups_ind</span> <span class="kw">=</span> <span class="no">simu_data</span>$<span class="no">Group</span>,<span class="kw">color_code</span> <span class="kw">=</span> <span class="no">simu_color</span>)</pre></body></html></div>
<p>A full list of supported palettes can be found with function <code>display.brewer.all()</code> in package <code>RColorBrewer</code>.</p>
</div>
</div>
<div id="example-2-adding-details-of-nodes-to-graphs-" class="section level1">
<h1 class="hasAnchor">
<a href="#example-2-adding-details-of-nodes-to-graphs-" class="anchor"></a>Example 2: Adding details of nodes to graphs.</h1>
<div id="using-default-summaries" class="section level2">
<h2 class="hasAnchor">
<a href="#using-default-summaries" class="anchor"></a>Using default summaries</h2>
<p>Extra summaries of nodes can be added to the graph with the function <code>network_visualization</code>, which is more powerful in providing additional summaries of nodes than <code>simple_visNet</code>.</p>
<p>The usage of <code>network_visualization</code> is similar to <code>simple_visNet</code>:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">tp_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="fl">1</span>)
<span class="no">ff</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_coordinate.html">filter_coordinate</a></span>(<span class="no">tp_data</span>[,-<span class="fl">1</span>], <span class="fl">2</span>)
<span class="no">tp_data_mapper</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper.kmeans.html">mapper.kmeans</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                               <span class="kw">filter_values</span> <span class="kw">=</span> <span class="no">ff</span>,
                               <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>,
                               <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/network_visualization.html">network_visualization</a></span>(<span class="no">tp_data_mapper</span>, <span class="kw">groups_ind</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Group</span>, <span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                      <span class="kw">folder</span> <span class="kw">=</span> <span class="st">"Exp_network"</span>)</pre></body></html></div>
<p>Note that, in this example, we called the function <code>filter_coordinate</code> to get the filter vector, which is the same as <code>tp_data$Y</code> and is one of the filter functions provided in the package. More examples of the filter functions can be found in Example 3.</p>
<p>One difference between <code>network_visualization</code> and <code>simple_visNet</code> is that in <code>network_visualization</code>, the groups of samples must be defined by users because the percentages of groups of samples in each node are part of the basic summary information. Nevertheless, <code>network_visualization</code> can automatically assign colors to groups, and color tools introduced in “Play with colors” can still be used to help the users to define their colors for different groups of samples.</p>
<p>The generated graphs from <code>network_visualization</code> and <code>simple_visnet</code> are also different. Besides the graph itself, the graph from <code>network_visualization</code> contains summaries of nodes which will show up when hovering the mouse cursor on a node. Basic summary information includes the number of samples in the node, the dominated group of the node, the percentages of groups of samples in the node and a pie plot depicting the percentages of groups.</p>
</div>
<div id="adding-customized-summaries" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-customized-summaries" class="anchor"></a>Adding customized summaries</h2>
<p>Users can also add customized summaries of nodes to the graph generated by <code>network_visualization</code>, which allows the users to evaluate the graph based on the unique features of the data. This is achieved by passing JavaScript organizing the summaries to <code>add_analysis_java</code> of <code>network_visualization</code></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">add_analysis_js</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Node Index:&lt;b&gt;'</span>,
                           <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">tp_data_mapper</span>$<span class="no">points_in_vertex</span>),
                           <span class="st">'&lt;/b&gt;&lt;br&gt;'</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/network_visualization.html">network_visualization</a></span>(<span class="no">tp_data_mapper</span>, <span class="kw">groups_ind</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Group</span>, <span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                      <span class="kw">folder</span> <span class="kw">=</span> <span class="st">"Exp_network"</span>, <span class="kw">add_analysis_js</span> <span class="kw">=</span> <span class="no">add_analysis_js</span>)</pre></body></html></div>
</div>
</div>
<div id="example-3-use-and-define-different-filter-functions-" class="section level1">
<h1 class="hasAnchor">
<a href="#example-3-use-and-define-different-filter-functions-" class="anchor"></a>Example 3: Use and define different filter functions.</h1>
<p>As shown in Example 2, filter functions are necessary to calculate the filter vectors. This package includes 7 built-in filter functions: <code>filter_ref</code>, <code>filter_pca</code>, <code>filter_Linf</code>, <code>filter_gaussian</code>, <code>filter_coordinate</code>, <code>filter_dtm</code>, <code>filter_eccen</code> as shown in the table below:</p>
<table class="table">
<colgroup>
<col width="12%">
<col width="13%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Name</th>
<th>Expression</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>filter_ref</code></td>
<td>Reference</td>
<td><span class="math inline">\(f(x_i;y,g) = 1−\text{median}_{y_j=g} d(x_i,x_j)\)</span></td>
</tr>
<tr class="even">
<td><code>filter_pca</code></td>
<td>PCA</td>
<td>
<span class="math inline">\(f(x_i) = x_i^T\phi_{(1)}\)</span>, where <span class="math inline">\(\phi_{(1)}\)</span> is the eigenvector associated with the largest eigenvalue of <span class="math inline">\(cov(X)\)</span>.</td>
</tr>
<tr class="odd">
<td><code>filter_Linf</code></td>
<td>L-infinity</td>
<td><span class="math inline">\(f(x_i) = max_{j} d(x_i,x_j)\)</span></td>
</tr>
<tr class="even">
<td><code>filter_gaussian</code></td>
<td>Gaussian density</td>
<td>density</td>
</tr>
<tr class="odd">
<td><code>filter_coordinate</code></td>
<td>Coordinate projection</td>
<td>projection</td>
</tr>
<tr class="even">
<td><code>filter_dtm</code></td>
<td>Distance to measure</td>
<td><span class="math inline">\(f(x_i;k) = \sqrt{\frac{1}{k}\sum_{j=2}^{k+1} d^2(x_i,x_{(j)})}\)</span></td>
</tr>
<tr class="odd">
<td><code>filter_eccen</code></td>
<td>Eccentricity</td>
<td><span class="math inline">\(f(x_i;p) = (\frac{1}{n}\sum_{j=1}^n d^p(x_i,x_j))^{1/p}\)</span></td>
</tr>
</tbody>
</table>
<p>Here we provide an example to show how to call a built-in filter function <code>filter_eccen</code> and pass the obtained filter vector to the <code>mapper.kmeans</code>. <code>filter_eccen</code> has two arguments, <code>dist</code> and <code>p</code>. <code>dist</code> accepts arbitrary distance matrix calculated based on the dataset. Many R functions and packages provide tools to calculate the distance matrix, such as the package <code>philentropy</code>. <code>p</code> is the exponent of the eccentricity filter function.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">tp_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="fl">1</span>)
<span class="no">tp_dist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="no">tp_data</span>[,-<span class="fl">1</span>])
<span class="no">ff</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_eccen.html">filter_eccen</a></span>(<span class="kw">dist</span> <span class="kw">=</span> <span class="no">tp_dist</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">tp_data_mapper</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper.kmeans.html">mapper.kmeans</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                               <span class="kw">filter_values</span> <span class="kw">=</span> <span class="no">ff</span>,
                               <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>,
                               <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/network_visualization.html">network_visualization</a></span>(<span class="no">tp_data_mapper</span>, <span class="kw">groups_ind</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Group</span>, <span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                      <span class="kw">folder</span> <span class="kw">=</span> <span class="st">"Exp_network"</span>)</pre></body></html></div>
<p>On the other hand, if users have the prior knowledge of the data they want to analyze, the reference filter function <code>filter_ref</code> can be a good choice to start with. <code>filter_ref</code> calculates the average distance between each of the samples and a group of reference samples. <code>filter_ref</code> has three arguments, <code>dist</code>, <code>groups_ind</code> and <code>ref</code>. <code>dist</code> accepts the distance matrix calculated based on the data, <code>groups_ind</code> should be a vector where each entry represents the group index of the corresponding sample point in the data, and <code>ref</code> is the index of the reference group. An example is shown below:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">tp_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="fl">1</span>)
<span class="no">tp_dist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="no">tp_data</span>[,-<span class="fl">1</span>])
<span class="no">ff</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_ref.html">filter_ref</a></span>(<span class="kw">dist</span><span class="kw">=</span><span class="no">tp_dist</span>, <span class="kw">groups_ind</span><span class="kw">=</span><span class="no">tp_data</span>$<span class="no">Group</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="st">"Shank"</span>)
<span class="no">tp_data_mapper</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper.kmeans.html">mapper.kmeans</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                               <span class="kw">filter_values</span> <span class="kw">=</span> <span class="no">ff</span>,
                               <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>,
                               <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)
<span class="fu"><a href="https://rdrr.io/pkg/STA/man/network_visualization.html">network_visualization</a></span>(<span class="no">tp_data_mapper</span>, <span class="kw">groups_ind</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Group</span>, <span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                      <span class="kw">folder</span> <span class="kw">=</span> <span class="st">"Exp_network"</span>)</pre></body></html></div>
<p>Besides the built-in filter functions, users can also define their standard filter functions. While <code>mapper.kmeans</code> can accept any numeric vector as a filter, the optimization function <code>filter_evaluate</code> can only accept <code>filter</code> object from standard filter functions. The return value from a standard filter function should have two attributes: <code>class</code> and <code>filter</code>. <code>class</code> should always be “filter”, and <code>filter</code> contains the name of the corresponding filter function. An example of a standard filter function is:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">filter_eccen</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">dist</span>, <span class="no">p</span>, <span class="no">...</span>) {

  <span class="no">dist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">dist</span>)
  <span class="no">res</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="no">dist</span>^<span class="no">p</span>)^(<span class="fl">1</span>/<span class="no">p</span>)
  <span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">res</span>)

  <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">res</span>, <span class="st">"filter"</span>) <span class="kw">&lt;-</span> <span class="st">"Eccentricity"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">res</span>) <span class="kw">&lt;-</span> <span class="st">"filter"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">res</span>)
}</pre></body></html></div>
</div>
<div id="example-4-result-evaluation-" class="section level1">
<h1 class="hasAnchor">
<a href="#example-4-result-evaluation-" class="anchor"></a>Example 4: Result evaluation.</h1>
<p>We can generate many graphs under the filter functions. While we can manually and empirically select graphs based on the domain knowledge we have about the data, it is important to evaluate these graphs objectively based on the prior knowledge of the data with some measures. In this section, we introduce two measures that can effectively assess the graphs from different aspects by comparing the graphs with the prior knowledge we have about the data.</p>
<div id="shannon-index" class="section level2">
<h2 class="hasAnchor">
<a href="#shannon-index" class="anchor"></a>Shannon index</h2>
<p>Shannon index [17] is an evaluation method measuring how diverse each node is. Specifically, given one node <span class="math inline">\(X_k\)</span>, and assuming samples are from <span class="math inline">\(L\)</span> different labels, the Shannon index is defined as follows: <span class="math display">\[\begin{array}{rl} H(X_{k}) &amp;\displaystyle = − \sum_{l=1}^{L} p_l\log p_l\\ p_l &amp;\displaystyle = \frac{|\{ x_{i} | x_{i} \in X_{k} \text{ and } y_i = l \} |}{|X_{k}|}.  \end{array}\]</span> where <span class="math inline">\(|.|\)</span> denotes the number of elements in a set.</p>
<p>Taking into account that the sizes of nodes are usually different, we measure the overall diversity of a graph as the weighted average of the Shannon indices weighted by the sizes of the nodes, which is <span class="math display">\[\bar{H}_f = \frac{ \sum_{j,k} |X_{k}| H(X_{k}) }{\sum_{j,k} |X_{k}|}.\]</span> Here, the subscript <span class="math inline">\(f\)</span> of <span class="math inline">\(\bar{H}_f\)</span> emphasizes that <span class="math inline">\(\bar{H}_f\)</span> depends on the filter function <span class="math inline">\(f\)</span>. Therefore, a small <span class="math inline">\(\bar{H}_f\)</span> implies the data points with different labels are well separated in different nodes, and the graph is good overall concerning node-wise diversity.</p>
<p>We demonstrate the calculation of Shannon index with the chicken foot example.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">tp_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="fl">1</span>)
<span class="no">tp_data_mapper</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper.kmeans.html">mapper.kmeans</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                                <span class="kw">filter_values</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Y</span>,
                                <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>,
                                <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)
<span class="no">tp_shannon</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper_shannon_index.html">mapper_shannon_index</a></span>(<span class="no">tp_data_mapper</span>, <span class="no">tp_data</span>$<span class="no">Group</span>)
<span class="no">tp_shannon</span></pre></body></html></div>
</div>
<div id="spread-measure" class="section level2">
<h2 class="hasAnchor">
<a href="#spread-measure" class="anchor"></a>Spread measure</h2>
<p>Although Shannon index can evaluate nodes of a graph, it neglects the connectivity of nodes. For example, these measures cannot detect the situation when two similar nodes containing samples with similar labels are separated from each other in a graph.</p>
<p>To compensate the Shannon index and evaluate graphs regarding the connectivity of nodes, we describe a heuristic sample-wise measure to evaluate how samples with the sample labels concentrate on a generated graph considering the structure of the graph. This measure is obtained as follows. First, for each data point in each of the nodes, we calculate the average distance between it and other data points with the same labels in the graph, where the distance is the length of the shortest path between nodes containing these points. Then we average the distance across all the data points. Mathematically, for one data point <span class="math inline">\(x_i\)</span> in a node <span class="math inline">\(X_k\)</span>, the average distance is defined as <span class="math display">\[    sp_{X_{k}}(x_i) = \frac{\sum_{\substack{k‘}} |\{ x\in X_{k‘}| y=y_i \}| q(X_{k}, X_{k‘}) }{\sum_{\substack{k‘}} |\{ x\in X_{k‘}| y=y_i \}|}\]</span> where <span class="math inline">\(q(X_{k}, X_{k‘})\)</span> is the length of the shortest path between nodes <span class="math inline">\(X_{k}\)</span> and <span class="math inline">\(X_{k‘}\)</span>. Note that, in this measure, we focus on the largest connected subgraph and ignore the points not included in the largest subgraph. For computational simplicity, duplicate data points appearing in multiple nodes are as different data points. The overall measure for the spread of data points in a graph is then <span class="math display">\[ \bar{sp}_f = \frac{ \sum_{\substack{i,k}} sp_{X_{k}}(x_i) }{\sum_{k} |{X_{k}}| } \]</span> where the subscript <span class="math inline">\(f\)</span> of <span class="math inline">\(\bar{sp}_f\)</span> emphasizes that <span class="math inline">\(\bar{sp}_f\)</span> depends on the filter function <span class="math inline">\(f\)</span>. A small <span class="math inline">\(\bar{sp}_f\)</span> indicates the nodes with similar samples are concentrated in a graph, and a graph is overall good regarding the connectivity of nodes.</p>
<p>We demonstrate the calculation of the spread measure with the chicken foot example.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">tp_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="fl">1</span>)
<span class="no">tp_data_mapper</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/mapper.kmeans.html">mapper.kmeans</a></span>(<span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>[,<span class="fl">2</span>:<span class="fl">4</span>],
                               <span class="kw">filter_values</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Y</span>,
                               <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>,
                               <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)
<span class="no">tp_spread</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/spread_measure.html">spread_measure</a></span>(<span class="no">tp_data_mapper</span>, <span class="no">tp_data</span>$<span class="no">Group</span>)
<span class="no">tp_spread</span></pre></body></html></div>
<p>It is worth noticing that <span class="math inline">\(\bar{H}_f\)</span> and <span class="math inline">\(\bar{sp}_f\)</span> measures the graph from two different aspects. <span class="math inline">\(\bar{H}_f\)</span> indicates whether labels of data points in each of the nodes in the graph are diverse or not in terms of data points’ labels, regardless of the connectivity of nodes, while <span class="math inline">\(\bar{sp}_f\)</span> implies if data points with the same labels from different nodes concentrate in the graph, it does not explicitly assess the clustering results and does not consider nodes not connected to the largest subgraph. Therefore, in practice, both measures should be taken into consideration when evaluating and diagnosing a graph from the Mapper. For example, large <span class="math inline">\(\bar{H}_f\)</span> and small <span class="math inline">\(\bar{sp}_f\)</span> imply the existence of large nodes consisting of many data points, while small <span class="math inline">\(\bar{H}_f\)</span> and large <span class="math inline">\(\bar{sp}_f\)</span> may indicate some data points with the same label are separated in the graph which requires more analysis based on the prior information of the data and the graph.</p>
</div>
</div>
<div id="example-5-filter-function-selection-with-pareto-frontier-" class="section level1">
<h1 class="hasAnchor">
<a href="#example-5-filter-function-selection-with-pareto-frontier-" class="anchor"></a>Example 5: Filter function selection with Pareto frontier.</h1>
<p>After generating graphs under different filter functions, the evaluation methods in Example 4 enable us to evaluate and compare the graphs from different aspects. The last problem is to find the optimal graphs regarding these measures. We solve this problem by borrowing methods for multi-objective optimization problems.</p>
<p>Given graphs generated under a set of filter functions <span class="math inline">\(F\)</span>, the problem of selecting the optimal filter functions can be formulated as <span class="math display">\[f=\text{argmin}_{f \in F} (\bar{H}_f, \bar{sp}_f).\]</span></p>
<p>We solve this problem by finding the pareto frontier. In this problem, the pareto frontier is defined as <span class="math display">\[\{f \in F| \{f‘ \in F|f‘\ne f,\bar{H}_{f‘} &lt; \bar{H}_{f} \text{ and } \bar{sp}_{f‘} &lt; \bar{sp}_{f} \} = \emptyset \}.\]</span></p>
<p>We generate an illustration of the pareto frontier with the package <code>ggplot2</code> and the function <code>pareto_opt</code> from the STA package assuming we have measures on seven graphs generated under different filter functions. First, we find the filter functions on the Pareto frontier with <code>pareto_opt</code>. Note that <code>pareto_opt</code> accept <code>data.frame</code> as input where the first column is the names of the filter functions and the second and third columns should be the corresponding Shannon indices and spread measures</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">STA</span>)
<span class="no">filter_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Coordinate"</span>,<span class="st">"Eccen"</span>,<span class="st">"LInf"</span>,<span class="st">"Ref"</span>,<span class="st">"DTM"</span>,<span class="st">"Gaussian"</span>,<span class="st">"PCA"</span>)
<span class="no">res_filter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">Filter</span> <span class="kw">=</span> <span class="no">filter_names</span>,
                        <span class="kw">weighted_shannon</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.389</span>, <span class="fl">1.221</span>, <span class="fl">1.453</span>, <span class="fl">1.158</span>, <span class="fl">1.345</span>, <span class="fl">1.399</span>, <span class="fl">1.349</span>),
                        <span class="kw">spread_measure</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.767</span>, <span class="fl">3.101</span>, <span class="fl">2.607</span>, <span class="fl">4.001</span>, <span class="fl">4.119</span>, <span class="fl">3.957</span>, <span class="fl">2.034</span>))
<span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/pareto_opt.html">pareto_opt</a></span>(<span class="no">res_filter</span>)
<span class="co">#&gt; Loading required package: rPref</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">res</span>)
<span class="co">#&gt; Filter functions in the Pareto frontier:</span>
<span class="co">#&gt;    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Evaluation results of filter functions in the Pareto frontier:</span>
<span class="co">#&gt;   Filter weighted_shannon spread_measure</span>
<span class="co">#&gt; 2  Eccen            1.221          3.101</span>
<span class="co">#&gt; 4    Ref            1.158          4.001</span>
<span class="co">#&gt; 7    PCA            1.349          2.034</span></pre></body></html></div>
<p>Then, we plot the results with <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># Illustration of Pareto frontier</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/pareto_opt.html">pareto_opt</a></span>(<span class="no">res_filter</span>, <span class="kw">top</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">res_filter</span>))
<span class="no">res</span>$<span class="no">.level</span>[<span class="no">res</span>$<span class="no">.level</span><span class="kw">&gt;</span><span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="st">"Others"</span>
<span class="no">res</span>$<span class="no">.level</span>[<span class="no">res</span>$<span class="no">.level</span><span class="kw">==</span><span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="st">"Frontier"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">res</span>) <span class="kw">&lt;-</span> <span class="st">"data.frame"</span>
<span class="no">gp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">weighted_shannon</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">spread_measure</span>,
                      <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">.level</span>),
                      <span class="kw">label</span> <span class="kw">=</span> <span class="no">Filter</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">group</span> <span class="kw">=</span> <span class="no">.level</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">res</span>[<span class="no">res</span>$<span class="no">.level</span><span class="kw">==</span><span class="st">"Frontier"</span>,],
            <span class="kw">direction</span> <span class="kw">=</span> <span class="st">"vh"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">.level</span>)), <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"white"</span>, <span class="kw">fontface</span> <span class="kw">=</span> <span class="st">"bold"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="st">''</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="st">''</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Shannon index"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Spread measure"</span>)</pre></body></html></div>
<p><img src="STA_files/figure-html/fig2-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In the graph, the red line represents the Pareto frontier, the red squares represent the filter functions on the Pareto frontier, and the blue squares represent the filter functions not in the Pareto frontier.</p>
<p>The package also provides a function, <code>filter_evaluate</code>, for users to efficiently get the measures for the graphs generated under different filter functions. It accepts arbitrary number of filter vectors from the filter functions and returns the measures as a <code>data.frame</code> object that can be directly used in the <code>pareto_opt</code> function. An example of using the <code>filter_evaluate</code> function is shown below for three filter functions on the chicken foot example:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">tp_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/chicken_generator.html">chicken_generator</a></span>(<span class="fl">1</span>)
<span class="no">tp_dist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="no">tp_data</span>[,-<span class="fl">1</span>])
<span class="no">fe</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_eccen.html">filter_eccen</a></span>(<span class="kw">dist</span> <span class="kw">=</span> <span class="no">tp_dist</span>, <span class="kw">p</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="no">fc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_coordinate.html">filter_coordinate</a></span>(<span class="no">tp_data</span>[,-<span class="fl">1</span>], <span class="fl">2</span>)
<span class="no">fg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_gaussian.html">filter_gaussian</a></span>(<span class="kw">dist</span><span class="kw">=</span><span class="no">tp_dist</span>, <span class="kw">sigma</span><span class="kw">=</span><span class="fl">1</span>)
<span class="no">res_eval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/filter_evaluate.html">filter_evaluate</a></span>(<span class="no">fe</span>,<span class="no">fc</span>,<span class="no">fg</span>,
                            <span class="kw">dat</span> <span class="kw">=</span> <span class="no">tp_data</span>, <span class="kw">group_ind</span> <span class="kw">=</span> <span class="no">tp_data</span>$<span class="no">Group</span>,
                            <span class="kw">num_intervals</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">percent_overlap</span> <span class="kw">=</span> <span class="fl">70</span>)</pre></body></html></div>
<p>Then the results can be passed to the <code>pareto_opt</code> function.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/STA/man/pareto_opt.html">pareto_opt</a></span>(<span class="no">res_eval</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">res</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tianshu Feng, Chen Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
